// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserType {
  NORMAL
  GROUP
  COMMUNITY
  GALAXY
}

enum TxFlowType {
  IN
  OUT
  TRANSFER
  ASSEMBLE
  NODE_REWARD
  NODE_DIFF_REWARD
  STAKE
  BURNING
  UNSTAKE
  STAKE_STATIC_REWARD
  STAKE_STATIC_DIRECT_REWARD
  STAKE_DYNAMIC_REWARD
  STAKE_DYNAMIC_INCUBATION_REWARD
  STAKE_DYNAMIC_NODE_REWARD
  STAKE_DYNAMIC_NODE_INCUBATION_REWARD
  MARKET_EXPENSE
  SECURITY_FUND
  CLAIM
  LOCK
  AIRDROP
  FLASH_SWAP
  FEE_DIVIDEND
  FEE_DIVIDEND_TOKEN
}

enum TxFlowStatus {
  PENDING
  CONFIRMED
  FAILED
  ABORT
  AUDITING
  REFUSED
}

enum TokenType {
  USDT
  TXT
}

model user_info {
  id            Int      @id @default(autoincrement()) // Auto-incrementing primary key
  address       String   @unique // Solana wallet address
  level         Int      @default(0) // User level
  min_level     Int?     @default(0) // User min level
  nonce         String?  // For wallet signature verification
  type          UserType?
  superior      String?  // Superior's Solana wallet address
  path          String?  // Materialized path storing the hierarchy path
  last_activity DateTime? // Last time user performed a point-earning action
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  buy_at        DateTime?
  balance       user_balance?
  referral_code String? @unique
  depth         Int     @default(0) // Depth in the hierarchy
  blacklist     Boolean?
  leader    String? // Galaxy leader
  interest_active  Boolean?

  @@index([superior])
  @@index([level])
  @@index([depth])
  @@index([path])
}

model user_balance {
  address              String   @id // Solana wallet address
  usdt_points         Decimal      @default(0) // USDT points balance
  token_points        Decimal      @default(0) // token points balance
  token_locked_points Decimal      @default(0) // Locked token points
  token_staked_points Decimal      @default(0) // Staked token points
  stake_reward_cap    Decimal      @default(0) // Stake reward cap
  stake_dynamic_reward_cap    Decimal      @default(0) // Staked token points
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt
  user                user_info @relation(fields: [address], references: [address])
}

model tx_flow {
  id            Int           @id @default(autoincrement())
  user_address  String
  to_address    String       @default("")
  amount        Decimal
  type          TxFlowType
  token_type    TokenType    // Type of token (USDT or TXT) @default(TXT)
  tx_hash       String?      
  status        TxFlowStatus @default(PENDING)
  description   String?      // Optional description of the transaction
  created_at    DateTime     @default(now())
  updated_at    DateTime     @updatedAt
  executed_at   DateTime     @default(now())

  @@index([user_address])
  @@index([type])
  @@index([status])
}

model transaction {
  id            Int              @id @default(autoincrement())
  tx_hash       String?          
  from_address  String
  to_address    String
  type          TxFlowType
  token_type    TokenType    // Type of token (USDT or TXT) @default(TXT)
  amount        Decimal
  amount_fee    Decimal?
  tx_fee        Decimal?
  status        TxFlowStatus @default(PENDING)
  description   String?      // Optional description of the transaction
  error         String?
  created_at    DateTime     @default(now())
  updated_at    DateTime     @updatedAt
}

model schedule_process {
  key   String @id @unique
  value String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model config {
  key   String @id @unique
  value String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model proclaim {
  id            Int           @id @default(autoincrement())
  index         Int
  locale        String
  title         String
  content       String @db.Text
  picture       String       @default("")
  display       Boolean
  created_at    DateTime     @default(now())
  updated_at    DateTime     @updatedAt
}

model performance_history {
  id                  Int           @id @default(autoincrement())
  address             String
  performance         Decimal      @default(0)
  token_staked_points   Decimal      @default(0)
  token_dynamic_reward  Decimal     @default(0)
  subordinates_num    Int @default(0)
  year                Int
  month               Int
  day                 Int
  created_at          DateTime     @default(now())
  updated_at          DateTime     @updatedAt

  @@unique([address, year, month, day])
}

enum TimeInterval {
  FIVE_MIN
  FIFTEEN_MIN
  THIRTY_MIN
  ONE_HOUR
  ONE_DAY
  ONE_WEEK
}

model token_price_candle {
  id            Int           @id @default(autoincrement())
  interval      TimeInterval  // Time interval (5min, 15min, 30min, 1hour, 1day, 1week)
  open_price    Decimal       // Opening price for this candle
  close_price   Decimal       // Closing price for this candle
  high_price    Decimal       // Highest price during this candle
  low_price     Decimal       // Lowest price during this candle
  volume        Decimal       @default(0) // Trading volume (can be mock data)
  timestamp     DateTime      // Start time of this candle
  created_at    DateTime      @default(now())
  updated_at    DateTime      @updatedAt

  @@unique([interval, timestamp]) // Ensure no duplicate candles for the same interval and timestamp
  @@index([interval, timestamp])  // Index for efficient querying by interval and time
}